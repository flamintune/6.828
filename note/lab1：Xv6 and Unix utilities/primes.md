# primes

- 实现并发版本的素数筛算法，利用管道

- 利用pipe和fork来创建pipeline，第一个进程将2到35送到管道里面，对于每一个素数，你要安排创造一个进程来读取

  你将安排创建一个进程，通过一个管道从其左边的邻居那里读取数据，并通过另一个管道向其右边的邻居写数据。

## hints

- 注意当进程不需要的时候，适当关掉文件描述符，即要自己去手动释放掉空闲的被占用的资源
- 一旦第一个进程到达35，他就应该再整个管道结束之前等起，然后等打印出来之后就退出
- read 会返回 0 当  管道的读一侧被关闭时



## solution

- 首先我们来拆解一下问题！
  - 如何将2到35送到管道里面去？

- 很显然这里需要对pipe以及fork两个系统调用的深度了解，所以要回去翻一下xv6 book chapter zero 的一些介绍
  - 重新看了一下文件描述符的内容，以及pipe的内容，以及通过配合fork来实现重定向，还有就是shell中的 `|` 的处理方式
    -  子进程创建一个管道连接管道的左右两端，然后它为左右两冠都调用 runcmd,然后通过两次wait等待左右两端结束，如果 | 过多的话，shell就会生成一个进程数，叶子节点是命令，中间节点是进程

- 为什么要安排创建一个进程从 左边读取数据，并写到右边去
- 这个就要用一个递归函数，每次fork出来的子进程负责筛数据，然后父进程继续fork，还有就是必须要改变标准输入输出，因为后续的子进程要用到前面的输入
- 还有就是内核编程里面可以说是几乎没有return 0，要自己去exit(0)
- 还有就是要实时地去释放掉不需要的fd勒些啊